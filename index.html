<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Town - Loading...</title>
    
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
</div>
        </div>
    </div>

    <!-- Landing Page Container -->
    <div id="landing-container"></div>

    <script>
        // Dynamic Landing Page Loader
        (function() {
            const container = document.getElementById('landing-container');
            const loadingScreen = document.getElementById('loading-screen');

            // Fetch and load the landing page
            fetch('landingpage/landing.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load landing page');
                    }
                    return response.text();
                })
                .then(html => {
                    // Parse the HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    // Update page title
                    document.title = doc.title || 'SQL Town';

                    // Extract and inject meta tags
                    const metaTags = doc.head.querySelectorAll('meta[name], meta[property]');
                    metaTags.forEach(meta => {
                        const existingMeta = document.head.querySelector(`meta[name="${meta.getAttribute('name')}"], meta[property="${meta.getAttribute('property')}"]`);
                        if (!existingMeta) {
                            document.head.appendChild(meta.cloneNode(true));
                        }
                    });

                    // Extract and inject favicon links
                    const faviconLinks = doc.head.querySelectorAll('link[rel*="icon"]');
                    faviconLinks.forEach(link => {
                        const newLink = document.createElement('link');
                        newLink.rel = link.rel;
                        newLink.type = link.type || '';
                        // Adjust path to be relative to root
                        newLink.href = 'landingpage/' + link.getAttribute('href');
                        document.head.appendChild(newLink);
                    });

                    // Extract and inject stylesheets
                    const stylesheets = doc.head.querySelectorAll('link[rel="stylesheet"]');
                    const stylesheetPromises = [];
                    
                    stylesheets.forEach(link => {
                        const href = link.getAttribute('href');
                        // Check if it's an external stylesheet (starts with http/https)
                        const isExternal = href.startsWith('http://') || href.startsWith('https://');
                        
                        if (!document.querySelector(`link[href="${href}"]`)) {
                            const stylePromise = new Promise((resolve) => {
                                const newLink = document.createElement('link');
                                newLink.rel = 'stylesheet';
                                // Adjust path for local files
                                newLink.href = isExternal ? href : 'landingpage/' + href;
                                newLink.onload = resolve;
                                newLink.onerror = resolve; // Continue even if fails
                                document.head.appendChild(newLink);
                            });
                            stylesheetPromises.push(stylePromise);
                        }
                    });

                    // Extract and inject external scripts from head
                    const headScripts = doc.head.querySelectorAll('script[src]');
                    headScripts.forEach(script => {
                        const src = script.getAttribute('src');
                        if (!document.querySelector(`script[src="${src}"]`)) {
                            const newScript = document.createElement('script');
                            newScript.src = src;
                            document.head.appendChild(newScript);
                        }
                    });

                    // Wait for stylesheets to load
                    Promise.all(stylesheetPromises).then(() => {
                        // Extract and inject inline styles
                        const inlineStyles = doc.head.querySelectorAll('style');
                        inlineStyles.forEach(style => {
                            const newStyle = document.createElement('style');
                            newStyle.textContent = style.textContent;
                            document.head.appendChild(newStyle);
                        });

                        // Insert body content
                        container.innerHTML = doc.body.innerHTML;

                        // Execute inline scripts from body
                        const bodyScripts = container.querySelectorAll('script');
                        bodyScripts.forEach(script => {
                            const newScript = document.createElement('script');
                            if (script.src) {
                                newScript.src = script.src;
                            } else {
                                newScript.textContent = script.textContent;
                            }
                            document.body.appendChild(newScript);
                        });

                        // Hide loading screen and show content
                        setTimeout(() => {
                            loadingScreen.classList.add('hidden');
                            container.classList.add('loaded');
                        }, 800);
                    });
                })
                .catch(error => {
                    console.error('Error loading landing page:', error);
                    container.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; flex-direction: column; font-family: sans-serif;">
                            <h1 style="color: #ff6b6b; margin-bottom: 1rem;">⚠️ Error Loading Page</h1>
                            <p style="color: #666;">Failed to load the landing page. Please refresh the page.</p>
                        </div>
                    `;
                    loadingScreen.classList.add('hidden');
                    container.classList.add('loaded');
                });
        })();
    </script>
</body>
</html>
